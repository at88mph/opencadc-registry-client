this.Registry=function(t,o,w,e){"use strict";var r;function i(e){var t=e||{};this.AUTH_TYPES={basic:"ivo://ivoa.net/sso#BasicAA",cookie:"ivo://ivoa.net/sso#cookie",tls:"ivo://ivoa.net/sso#tls-with-certificate"},this.LINE_CHECKER=/^[\w]+.*$/,this.resourceCapabilitiesURL=t.resourceCapabilitiesEndPoint||"https://www.cadc-ccda.hia-iha.nrc-cnrc.gc.ca/reg/resource-caps"}return String.prototype.trim||(r=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,String.prototype.trim=function(){return this.replace(r,"")}),i.prototype.getResourceCapabilities=function(e){return this._get(e,"text/xml")},i.prototype.getServiceURL=function(e,b,m,R,C){var L=this;return new t(function(E,y){L.getCapabilityURL(e).then(function(e){L.getResourceCapabilities(e).then(function(e){for(var t=(e.responseXML||(new w).parseFromString(e.responseText)).documentElement.getElementsByTagName("capability"),r=0,i=t.length;r<i;r++){var n=t[r];if(n.getAttribute("standardID")===b)for(var o=n.getElementsByTagName("interface"),s=[],a=0,c=o.length;a<c;a++){var u=o[a],p=u.getElementsByTagName("securityMethod");if((!R&&0===p.length||R&&0<p.length&&p[0].getAttribute("standardID")===L.AUTH_TYPES[R.toLowerCase()])&&u.getAttribute("xsi:type")===m){var l=u.getElementsByTagName("accessURL"),g=0<l.length?l[0].childNodes[0].nodeValue:null;g&&s.push(g)}}}if(0===s.length)y(new Error("No service URL found"));else{for(var h=[],f=0,d=s.length;f<d;f++){var v=s[f];!0===C&&0===v.indexOf("http://")||(!C||!0!==C)&&0===v.indexOf("https://")?h.splice(0,0,v):h.push(v)}E(h[0])}}).catch(function(e){console.error("Error obtaining Service URL > "+(e.error?e.error:e))})}).catch(function(e){console.error("Error obtaining Capability URL > "+(e.error?e.error:e))})})},i.prototype.getResourceCapabilitiesEndpoints=function(){return this._get(this.resourceCapabilitiesURL,"text/plain")},i.prototype.getCapabilityURL=function(u){var p=this;return new t(function(a,c){p.getResourceCapabilitiesEndpoints().then(function(e){for(var t,r=e.responseText.split("\n"),i=0,n=r.length;i<n;i++){var o=r[i];if(p.LINE_CHECKER.test(o)){var s=o.split("=");if(s[0].trim()===u){t=s[1].trim();break}}}t?a(t):c({uri:u,error:new Error("No such URI "+u)})}).catch(function(e){console.error("Error obtaining capability URL > "+(e.error?e.error:e))})})},i.prototype._get=function(i,n){return new t(function(e,t){var r=new o;r.addEventListener("load",function(){e(r)},!1),r.addEventListener("error",function(){t(r.responseText)},!1),r.withCredentials=!0,r.open("GET",i),r.setRequestHeader("Content-Type",n),r.send(null)})},"undefined"!=typeof module&&module.exports&&(module.exports=i),i}(Promise,XMLHttpRequest,DOMParser);